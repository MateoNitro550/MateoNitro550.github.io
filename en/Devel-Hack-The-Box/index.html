<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Devel - Hack The Box</title>

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="icon" href="/assets/iamges/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/images/favicon.gif" type="image/gif">

  <link rel="stylesheet" href="/assets/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Devel - Hack The Box | Filthy Hacker</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Devel - Hack The Box" />
<meta name="author" content="Mateo Andino" />
<meta property="og:locale" content="en" />
<meta name="description" content="Filthy Hacker es un blog dedicado al hacking. ¿Te apasiona la ciberseguridad, o quieres aprender? ¡Este es el lugar! Resolución de máquinas, explicación de vulnerabilidades, CTF’s y varias temáticas relacionadas al hacking." />
<meta property="og:description" content="Filthy Hacker es un blog dedicado al hacking. ¿Te apasiona la ciberseguridad, o quieres aprender? ¡Este es el lugar! Resolución de máquinas, explicación de vulnerabilidades, CTF’s y varias temáticas relacionadas al hacking." />
<meta property="og:site_name" content="Filthy Hacker" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2024-10-21T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Devel - Hack The Box" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mateo Andino","url":"https://mateonitro550.github.io"},"dateModified":"2024-10-21T00:00:00-04:00","datePublished":"2024-10-21T00:00:00-04:00","description":"Filthy Hacker es un blog dedicado al hacking. ¿Te apasiona la ciberseguridad, o quieres aprender? ¡Este es el lugar! Resolución de máquinas, explicación de vulnerabilidades, CTF’s y varias temáticas relacionadas al hacking.","headline":"Devel - Hack The Box","mainEntityOfPage":{"@type":"WebPage","@id":"/en/Devel-Hack-The-Box/"},"url":"/en/Devel-Hack-The-Box/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PPKV9V8T');</script>
  <!-- End Google Tag Manager -->

</head>



<body>

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPKV9V8T"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1 class="glitch-header">filthyHacker@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/en"><h2 class="header-link">Posts</h2></a>
<a href="/en/search"><h2 class="header-link">Search</h2></a>
<a href="/en/archive"><h2 class="header-link">Archive</h2></a>
<a href="/es"><h2 class="header-link">Español</h2></a>

    </div>
  </div>
</header>

    <div class="container">
      <section id="main_content">
        <article>
  <h2>Devel - Hack The Box</h2>
  <time datetime="2024-10-21T00:00:00-04:00" class="by-line">
    
      10/21/2024
    
  </time>
  <p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/1.png" alt="Info Card" class="blog-image" onclick="expandImage(this)" /></p>

<p>This time we are going to solve <em>Hack The Box’s</em> <em>Devel</em> machine. It is an easy-level <em>Windows</em> machine, both in terms of exploitation and privilege escalation.</p>

<h3 id="reconnaissance-phase"><a href="#header-3"></a>Reconnaissance Phase</h3>

<p>First, we’re going to launch an <em>ICMP traceroute</em> to check if the machine is active.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.10.5
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/2.png" alt="2" class="blog-image" onclick="expandImage(this)" /></p>

<p>Once we verify that the machine is active (as it returns a response), we can also determine what type of machine we are dealing with based on the <em>TTL</em> value; in this case, the machine’s <em>TTL</em> value is <code class="language-plaintext highlighter-rouge">127</code>, so we can infer that we are dealing with a <em>Windows</em> machine. Remember, some of the reference values are as follows:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Operating System (OS)</th>
      <th style="text-align: left">TTL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Linux</td>
      <td style="text-align: left">64</td>
    </tr>
    <tr>
      <td style="text-align: left">Windows</td>
      <td style="text-align: left">128</td>
    </tr>
    <tr>
      <td style="text-align: left">Solaris</td>
      <td style="text-align: left">254</td>
    </tr>
  </tbody>
</table>

<p>If we notice, in this case, the <em>TTL</em> value is <code class="language-plaintext highlighter-rouge">127</code> instead of <code class="language-plaintext highlighter-rouge">128</code> as indicated in the table above. This is because, in the <em>Hack The Box</em> environment, we are not communicating directly with the target machine; instead, there is an intermediary node, which causes the <em>TTL</em> to decrease by one unit.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.10.5 -R
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/3b.png" alt="3" class="blog-image" onclick="expandImage(this)" /></p>

<p>Next, we will use the <em>Nmap</em> tool to determine which ports are open, as well as identify the version and services running on the asset. To determine which ports are open, we can do the following:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-T5</span> <span class="nt">-v</span> <span class="nt">-n</span> 10.10.10.5
</code></pre></div></div>

<p>If the scan takes too long to complete, we have this alternative:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.5
</code></pre></div></div>

<p>Below is an explanation of the parameters used in the port scan with <em>Nmap</em>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parameter</th>
      <th style="text-align: left">Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">-p-</td>
      <td style="text-align: left">Scans the entire range of ports (65535 in total)</td>
    </tr>
    <tr>
      <td style="text-align: left">--open</td>
      <td style="text-align: left">Shows all ports that are open (or possibly open)</td>
    </tr>
    <tr>
      <td style="text-align: left">-T5</td>
      <td style="text-align: left">The timing template allows us to speed up our scan; this value can range from 0 to 5. Note that the higher the value of the template, the more “noise” we generate, but that’s okay, right? After all, we’re practicing in a controlled environment, and here we are all <code class="language-plaintext highlighter-rouge">White Hat</code></td>
    </tr>
    <tr>
      <td style="text-align: left">-v</td>
      <td style="text-align: left"><em>Verbose</em>, reports findings to the console</td>
    </tr>
    <tr>
      <td style="text-align: left">-n</td>
      <td style="text-align: left">Do not apply <em>DNS resolution</em></td>
    </tr>
    <tr>
      <td style="text-align: left">-sS</td>
      <td style="text-align: left"><em>TCP SYN</em> scan</td>
    </tr>
    <tr>
      <td style="text-align: left">-min-rate</td>
      <td style="text-align: left">Send packets no slower than &lt;value&gt; per second</td>
    </tr>
    <tr>
      <td style="text-align: left">-vvv</td>
      <td style="text-align: left">Triple <em>verbose</em>, to get more information in the console</td>
    </tr>
    <tr>
      <td style="text-align: left">-Pn</td>
      <td style="text-align: left">Do not apply <em>host discovery</em></td>
    </tr>
  </tbody>
</table>

<p>Once we have detected the open ports on the asset, we can move on to determine the version and services running on these ports.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p</span> 21,80 10.10.10.5
</code></pre></div></div>

<p>Below is an explanation of the parameters used in the version and service scan with <em>Nmap</em>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parameter</th>
      <th style="text-align: left">Explanation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">-sC</td>
      <td style="text-align: left">Basic enumeration scripts</td>
    </tr>
    <tr>
      <td style="text-align: left">-sV</td>
      <td style="text-align: left">Version and services running on the found ports</td>
    </tr>
    <tr>
      <td style="text-align: left">-p</td>
      <td style="text-align: left">Specify which ports we want to analyze (those found open in the previous step)</td>
    </tr>
  </tbody>
</table>

<p>Based on the information reported by <em>Nmap</em>, we can see that the target machine has open ports related to <code class="language-plaintext highlighter-rouge">HTTP</code> and <code class="language-plaintext highlighter-rouge">FTP</code> (File Transfer Protocol).</p>

<h3 id="exploitation-phase"><a href="#header-3"></a>Exploitation Phase</h3>

<p>We can start by enumerating the <code class="language-plaintext highlighter-rouge">HTTP</code> service. To do this, we can use <code class="language-plaintext highlighter-rouge">WhatWeb</code>, a tool that identifies the web technologies being used. This includes content management systems (CMS), libraries, plugins, or even the operating system hosting the web server.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whatweb http://10.10.10.5
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/4.png" alt="4" class="blog-image" onclick="expandImage(this)" /></p>

<p>There’s nothing particularly interesting, except that the website is hosted on <code class="language-plaintext highlighter-rouge">IIS</code> (Internet Information Services), a web server developed by <em>Microsoft</em> to host sites on <em>Windows</em> systems, and that the website appears to be under construction.</p>

<p>Since we can’t gather more useful information from the terminal, we will need to visit the website from our browser. We will only see the <code class="language-plaintext highlighter-rouge">IIS</code> version 7 logo, so there doesn’t seem to be much to do here at the moment.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/5.png" alt="5" class="blog-image" onclick="expandImage(this)" /></p>

<p>The next thing we can do is to enumerate the <code class="language-plaintext highlighter-rouge">FTP</code> service. For this, we’ll use a <em>null session</em>, as we don’t have credentials.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ftp anonymous@10.10.10.5
</code></pre></div></div>

<p>Upon connecting, we can see what appears to be the file structure of the website hosted on <code class="language-plaintext highlighter-rouge">IIS</code>. We find a directory called <code class="language-plaintext highlighter-rouge">aspnet_client</code> and files like <code class="language-plaintext highlighter-rouge">iisstart.htm</code> and <code class="language-plaintext highlighter-rouge">welcome.png</code>.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/6.png" alt="6" class="blog-image" onclick="expandImage(this)" /></p>

<p>We can verify this by downloading one of these files and viewing it on our system. For instance, we can try with the <code class="language-plaintext highlighter-rouge">welcome.png</code> image. Since this is a non-text file, we will switch the transfer mode to <em>binary</em>, which ensures that the file is transferred without modifications, preserving its integrity byte by byte.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>binary
get welcome.png
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/7.png" alt="7" class="blog-image" onclick="expandImage(this)" /></p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/8.png" alt="8" class="blog-image" onclick="expandImage(this)" /></p>

<p>We confirm that we are seeing the same image we previously viewed in the browser, suggesting a possible file upload path to the web server. As a test, we can upload a file via <code class="language-plaintext highlighter-rouge">FTP</code> and see if it appears on the website. In my case, I tested with an image.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>put &lt;fileName&gt;
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/9.png" alt="9" class="blog-image" onclick="expandImage(this)" /></p>

<p>We see that the image appears correctly on the webpage, so we can attempt to upload a <em>reverse shell</em> to the server. One thing to keep in mind is that <code class="language-plaintext highlighter-rouge">IIS</code> uses <code class="language-plaintext highlighter-rouge">ASP</code>/<code class="language-plaintext highlighter-rouge">ASP.NET</code> for server-side script execution. <code class="language-plaintext highlighter-rouge">ASP.NET</code> is the more modern version of the <code class="language-plaintext highlighter-rouge">ASP</code> framework and is based on the <code class="language-plaintext highlighter-rouge">.NET</code> framework, which is <em>Microsoft’s</em> development platform for creating applications. Therefore, the <em>reverse shell</em> we upload will need to be in <code class="language-plaintext highlighter-rouge">.aspx</code> format so that the server can interpret and execute it correctly.</p>

<p>That said, we could generate the <em>reverse shell</em> with <code class="language-plaintext highlighter-rouge">MSFvenom</code> or find one publicly available on GitHub. In my case, I’ll use the <a href="https://github.com/borjmz/aspx-reverse-shell/blob/master/shell.aspx">shell</a> by user <code class="language-plaintext highlighter-rouge">borjmz</code>. We just need to change our IP and port where indicated, and then upload the <em>shell</em>.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>put shell.aspx
</code></pre></div></div>

<p>We can go to <a href="http://10.10.10.5/shell.aspx">http://10.10.10.5/shell.aspx</a> or execute it from the console with:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>curl http://10.10.10.5/shell.aspx
</code></pre></div></div>

<p>Either way, we will get a shell inside the target machine as the user <code class="language-plaintext highlighter-rouge">IIS APPPOOL\web</code>, so we’ll need to escalate privileges.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/10.png" alt="10" class="blog-image" onclick="expandImage(this)" /></p>

<h3 id="privilege-escalation"><a href="#header-3"></a>Privilege Escalation</h3>

<p>We can start by enumerating the operating system using <code class="language-plaintext highlighter-rouge">systeminfo</code> to find its version and check whether patches have been applied.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>systeminfo
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/11.png" alt="11" class="blog-image" onclick="expandImage(this)" /></p>

<p>We find that the operating system version is <code class="language-plaintext highlighter-rouge">6.1.7600 Build 7600</code>, with no patches applied. Upon further research, we discover that this version is vulnerable to <code class="language-plaintext highlighter-rouge">MS11-046</code>, a vulnerability caused by the <em>Microsoft Windows Ancillary Function Driver</em> (<em>AFD.sys</em>), which, when running in privileged kernel mode, fails to properly validate input provided by low-privileged users.</p>

<p>We can search online for an exploit to take advantage of this vulnerability. There is already a compiled version available, which is the one we will <a href="https://www.exploit-db.com/exploits/40564">use</a>. Since we have a potential way to upload files via the <code class="language-plaintext highlighter-rouge">FTP</code> service, we can leverage this by searching for the path where the files we saw earlier are located. For instance, we can perform a recursive search on the system to verify where the <code class="language-plaintext highlighter-rouge">welcome.png</code> image we saw earlier is stored.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">dir</span> /s welcome.png
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/12.png" alt="12" class="blog-image" onclick="expandImage(this)" /></p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/13.png" alt="13" class="blog-image" onclick="expandImage(this)" /></p>

<p>Knowing that the files are located in the <code class="language-plaintext highlighter-rouge">C:\inetpub\wwwroot</code> directory, we can upload the exploit via <code class="language-plaintext highlighter-rouge">FTP</code>, and once the file is on the target machine, we will be able to execute it directly from there.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>binary
put MS11-046.exe
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/14.png" alt="14" class="blog-image" onclick="expandImage(this)" /></p>

<p>By executing it, we will gain elevated privileges, becoming <code class="language-plaintext highlighter-rouge">NT AUTHORITY\SYSTEM</code>, which will allow us to list the flags for both users on the system.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2024-09-30-Devel-Hack-The-Box/15.png" alt="15" class="blog-image" onclick="expandImage(this)" /></p>

</article>

<div id="carousel" class="carousel">
  <img id="carouselImage" class="carousel-image">
  <div id="carouselAlt" class="carousel-alt"></div>
  <button class="carousel-control prev" onclick="prevImage()">&#10094;</button>
  <button class="carousel-control next" onclick="nextImage()">&#10095;</button>
</div>

<div class="image-overlay" onclick="closeImage()"></div>
<img id="expandedImage" class="expanded-image">

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var tocList = document.getElementById('toc-list');
    var headers = document.querySelectorAll('article h3');

    if (headers.length > 0) {
      document.querySelector('.toc').style.display = 'block';

      headers.forEach(function(header, index) {
        var id = 'section-' + index;
        header.id = id;

        var listItem = document.createElement('li');
        var link = document.createElement('a');
        link.href = '#' + id;
        link.textContent = header.textContent;
        listItem.appendChild(link);
        tocList.appendChild(listItem);
      });
    } else {
      document.querySelector('.toc').style.display = 'none';
    }
  });

  var currentImageIndex = 0;
  var images = [];
  var altTexts = [];

  document.querySelectorAll('.blog-image').forEach((img, index) => {
    images.push(img.src);
    altTexts.push(img.alt || '');
    img.setAttribute('data-index', index);
    img.onclick = () => expandImage(img);
  });

  function expandImage(img) {
    currentImageIndex = parseInt(img.getAttribute('data-index'));
    showImage(currentImageIndex);
    document.getElementById('carousel').style.display = 'block';
    document.querySelector('.image-overlay').style.display = 'block';
    document.body.style.overflow = 'hidden';

    document.addEventListener('keydown', handleKeyPress);

    document.querySelectorAll('.carousel-control').forEach(control => {
      control.style.display = 'block';
    });
  }

  function showImage(index) {
    var carouselImg = document.getElementById('carouselImage');
    carouselImg.src = images[index];
    
    var carouselAlt = document.getElementById('carouselAlt');
    carouselAlt.textContent = altTexts[index];
  }

  function closeImage() {
    document.getElementById('carousel').style.display = 'none';
    document.querySelector('.image-overlay').style.display = 'none';
    document.body.style.overflow = 'auto';

    document.removeEventListener('keydown', handleKeyPress);

    document.querySelectorAll('.carousel-control').forEach(control => {
      control.style.display = 'none';
    });
  }

  function prevImage() {
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    showImage(currentImageIndex);
  }

  function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    showImage(currentImageIndex);
  }

  function handleKeyPress(event) {
    if (event.key === 'Escape') {
      closeImage();
    } else if (event.key === 'ArrowLeft') {
      prevImage();
    } else if (event.key === 'ArrowRight') {
      nextImage();
    }
  }
</script>

      </section>
    </div>
  </div>

  

  <footer>
  <a href="https://creativecommons.org/licenses/by-nc/4.0/">
    <span>
        <b>MateoNitro550</b>
    </span>
    
    <span>© 2024</span>
  </a>
</footer>


  
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-524F5BE8G5', 'auto');
  ga('send', 'pageview');
</script>
  

</body>
</html>
