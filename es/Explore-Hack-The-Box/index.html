<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
  <meta name="generator" content="Jekyll">

  <title>Explore - Hack The Box</title>

  <link rel="shortcut icon" href="/assets/images/favicon.ico">
  <link rel="icon" href="/assets/iamges/favicon.ico" type="image/x-icon">
  <link rel="icon" href="/assets/images/favicon.gif" type="image/gif">

  <link rel="stylesheet" href="/assets/css/main.css">
  
  <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="ATOM Feed" /> <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Explore - Hack The Box | Filthy Hacker</title>
<meta name="generator" content="Jekyll v4.3.4" />
<meta property="og:title" content="Explore - Hack The Box" />
<meta name="author" content="Mateo Andino" />
<meta property="og:locale" content="es" />
<meta name="description" content="En esta ocasión vamos a estar resolviendo la máquina Explore de Hack The Box. Es una máquina Android de nivel de dificultad fácil en la intrusión, y medio en la escalada de privilegios según figura en la plataforma. Fase De Reconocimiento Primeramente vamos a lanzar una traza ICMP para saber si la máquina está activa. ping -c 1 10.10.10.247 Una vez comprobamos que la máquina está activa (pues nos devuelve una respuesta), podemos también determinar a que tipo de máquina nos estamos enfrentando en base al valor del TTL; en este caso el valor del TTL de la máquina es 63, por lo que podemos intuir que estamos ante una máquina Linux. Recordemos que algunos de los valores referenciales son los siguientes: Sistema Operativo (OS) TTL Linux 64 Windows 128 Solaris 254 Si nos damos cuenta, en esta ocasión, el valor del TTL es 63 y no 64 como indica la tabla anterior, esto se debe a que en el entorno de máquinas de Hack The Box, no nos comunicamos directamente con la máquina a vulnerar, sino que existe un nodo intermediario, por lo que el TTL disminuye en una unidad. ping -c 1 10.10.10.247 -R Posteriormente, vamos a utilizar la herramienta Nmap para determinar que puertos están abiertos, así como identificar la versión y servicios que corren en el activo. Para determinar que puertos están abiertos podemos realizar lo siguiente: nmap -p- --open -T5 -v -n 10.10.10.247 En caso de que el escaneo tarde demasiado en completar, tenemos esta otra alternativa: sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de puertos con Nmap: Parámetro Explicación -p- Escanea todo el rango de puertos (65535 en total) --open Nos indica todos aquellos puertos que están abiertos (o posiblemente abiertos) -T5 La plantilla de temporizado nos permite agilizar nuestro escaneo, este valor puede ir desde 0 hasta 5, cabe aclarar que a mayor sea el valor de la plantilla, “generaremos más ruido”, pero no pasa nada ¿no? Al fin y al cabo estamos practicando en un entorno controlado y aquí somos todos White Hat -v Verbose, reporta lo encontrado por consola -n No aplicar resolución DNS -sS Escaneo TCP SYN -min-rate Emitir paquetes no más lentos que &lt;valor&gt; por segundo -vvv Triple verbose, para obtener mayor información por consola -Pn No aplicar host discovery Una vez hemos detectado los puertos que se encuentran abiertos en el activo, podemos pasar a determinar la versión y servicios que corren bajo estos puertos. nmap -sC -sV -p 2222,42135,42607,59777 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de versiones y servicios con Nmap: Parámetro Explicación -sC Scripts básicos de enumeración -sV Versión y servicios que corren bajo los puertos encontrados -p Especificamos que puertos queremos analizar (los que encontramos abiertos en el paso anterior) Basándonos en la información que nos reporta Nmap, podemos darnos cuenta que nos encontramos frente a un teléfono móvil, y nuestra primera gran pista para la siguiente fase es el puerto 42135. Fase De Explotación Para explotar el servicio ES File Explorer, empezaremos buscando algún exploit que se encuentre en Exploit Database, para ello utilizaremos SearchSploit para poder seguir trabajando desde nuestra terminal. searchsploit ES File Explorer En este caso SearchSploit no mostró nada interesante, sin embargo, si revisamos manualmente en la página de Exploit Database, podemos encontrar un script que nos permite leer archivos alojados en el servicio de ES File Explorer de versión 4.1.9.7.4, por esta razón es importante no quedarnos conformes únicamente con el primer resultado que encontremos. Sin embargo, tampoco será este el script con el que trabajaremos; en esta ocasión estaremos utilizando un proyecto de GitHub del usuario fs0c131y, este se llama ESFileExplorerOpenPortVuln. Para empezar a trabajar con este repositorio bastará con clonarlo en nuestra máquina. git clone https://github.com/fs0c131y/ESFileExplorerOpenPortVuln Una vez lo tengamos descargado, podemos empezar a revisar que información se alojaba en el servicio ES File Explorer. Después de estar listando el contenido almacenado en el teléfono móvil, encontramos entre las fotografías, una llamada creds, lo cual nos hace pensar a que se refiere a credenciales con las que posteriormente autenticarnos. python3 poc.py --cmd listPics --ip 10.10.10.247 Por lo que procedemos a descargar esta imagen. python3 poc.py --get-file /storage/emulated/0/DCIM/creds.jpg --ip 10.10.10.247 Si recordamos, otro servicio que detectamos con Nmap, fue el servicio SSH en el puerto 2222. Por lo que procederemos a autenticarnos con las credenciales encontradas: ssh kristi@10.10.10.247 -p 2222 Una vez dentro de la máquina, procederemos a buscar la primera flag. Por lo que buscaremos el archivo user.txt dentro de todo el sistema. echo **/*user.txt* Podemos ver que en efecto esta es la flag del usuario con bajos privilegios. Lo más común sería utilizar find / -name user.txt (y en este caso, redirigir todo el stderr o Standard Error hacia el /dev/null), sin embargo, no conseguimos ningún resultado en esta máquina, por lo que resulta conveniente conocer otros métodos para realizar el mismo proceso. Escalada De Privilegios Para poder conseguir la siguiente flag (la del usuario con máximos privilegios), tenemos que percatarnos que la máquina tiene más puertos abiertos que los registrados con Nmap, a estos se los conoce como puertos internos. netstat -nlpt Si nos percatamos, la máquina utiliza el puerto 5555 para realizar varios procesos relacionados con Android; esto tiene sentido ya que algunos dispositivos Android tienen este puerto abierto para realizar procesos relacionados con el Android Debug Bridge o ADB por sus siglas en inglés. Por lo que, lo que vamos a realizar es un local port forwarding, para posteriormente, con el servicio ADB conseguir una shell de máximos privilegios con la que poder migrar al usuario root y conseguir la última flag. En caso de no contar con el servicio ADB instalado, bastará con realizar lo siguiente: sudo apt install adb Una vez instalado el servicio ADB, podemos pasar a conseguir una shell con máximos privilegios dentro del dispositivo. ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222 adb start-server adb connect localhost:5555 adb devices adb -s localhost:5555 shell su root Una vez hemos migrado al usuario root, simplemente tendremos que buscar la respectiva flag. echo **/*root.txt*" />
<meta property="og:description" content="En esta ocasión vamos a estar resolviendo la máquina Explore de Hack The Box. Es una máquina Android de nivel de dificultad fácil en la intrusión, y medio en la escalada de privilegios según figura en la plataforma. Fase De Reconocimiento Primeramente vamos a lanzar una traza ICMP para saber si la máquina está activa. ping -c 1 10.10.10.247 Una vez comprobamos que la máquina está activa (pues nos devuelve una respuesta), podemos también determinar a que tipo de máquina nos estamos enfrentando en base al valor del TTL; en este caso el valor del TTL de la máquina es 63, por lo que podemos intuir que estamos ante una máquina Linux. Recordemos que algunos de los valores referenciales son los siguientes: Sistema Operativo (OS) TTL Linux 64 Windows 128 Solaris 254 Si nos damos cuenta, en esta ocasión, el valor del TTL es 63 y no 64 como indica la tabla anterior, esto se debe a que en el entorno de máquinas de Hack The Box, no nos comunicamos directamente con la máquina a vulnerar, sino que existe un nodo intermediario, por lo que el TTL disminuye en una unidad. ping -c 1 10.10.10.247 -R Posteriormente, vamos a utilizar la herramienta Nmap para determinar que puertos están abiertos, así como identificar la versión y servicios que corren en el activo. Para determinar que puertos están abiertos podemos realizar lo siguiente: nmap -p- --open -T5 -v -n 10.10.10.247 En caso de que el escaneo tarde demasiado en completar, tenemos esta otra alternativa: sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de puertos con Nmap: Parámetro Explicación -p- Escanea todo el rango de puertos (65535 en total) --open Nos indica todos aquellos puertos que están abiertos (o posiblemente abiertos) -T5 La plantilla de temporizado nos permite agilizar nuestro escaneo, este valor puede ir desde 0 hasta 5, cabe aclarar que a mayor sea el valor de la plantilla, “generaremos más ruido”, pero no pasa nada ¿no? Al fin y al cabo estamos practicando en un entorno controlado y aquí somos todos White Hat -v Verbose, reporta lo encontrado por consola -n No aplicar resolución DNS -sS Escaneo TCP SYN -min-rate Emitir paquetes no más lentos que &lt;valor&gt; por segundo -vvv Triple verbose, para obtener mayor información por consola -Pn No aplicar host discovery Una vez hemos detectado los puertos que se encuentran abiertos en el activo, podemos pasar a determinar la versión y servicios que corren bajo estos puertos. nmap -sC -sV -p 2222,42135,42607,59777 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de versiones y servicios con Nmap: Parámetro Explicación -sC Scripts básicos de enumeración -sV Versión y servicios que corren bajo los puertos encontrados -p Especificamos que puertos queremos analizar (los que encontramos abiertos en el paso anterior) Basándonos en la información que nos reporta Nmap, podemos darnos cuenta que nos encontramos frente a un teléfono móvil, y nuestra primera gran pista para la siguiente fase es el puerto 42135. Fase De Explotación Para explotar el servicio ES File Explorer, empezaremos buscando algún exploit que se encuentre en Exploit Database, para ello utilizaremos SearchSploit para poder seguir trabajando desde nuestra terminal. searchsploit ES File Explorer En este caso SearchSploit no mostró nada interesante, sin embargo, si revisamos manualmente en la página de Exploit Database, podemos encontrar un script que nos permite leer archivos alojados en el servicio de ES File Explorer de versión 4.1.9.7.4, por esta razón es importante no quedarnos conformes únicamente con el primer resultado que encontremos. Sin embargo, tampoco será este el script con el que trabajaremos; en esta ocasión estaremos utilizando un proyecto de GitHub del usuario fs0c131y, este se llama ESFileExplorerOpenPortVuln. Para empezar a trabajar con este repositorio bastará con clonarlo en nuestra máquina. git clone https://github.com/fs0c131y/ESFileExplorerOpenPortVuln Una vez lo tengamos descargado, podemos empezar a revisar que información se alojaba en el servicio ES File Explorer. Después de estar listando el contenido almacenado en el teléfono móvil, encontramos entre las fotografías, una llamada creds, lo cual nos hace pensar a que se refiere a credenciales con las que posteriormente autenticarnos. python3 poc.py --cmd listPics --ip 10.10.10.247 Por lo que procedemos a descargar esta imagen. python3 poc.py --get-file /storage/emulated/0/DCIM/creds.jpg --ip 10.10.10.247 Si recordamos, otro servicio que detectamos con Nmap, fue el servicio SSH en el puerto 2222. Por lo que procederemos a autenticarnos con las credenciales encontradas: ssh kristi@10.10.10.247 -p 2222 Una vez dentro de la máquina, procederemos a buscar la primera flag. Por lo que buscaremos el archivo user.txt dentro de todo el sistema. echo **/*user.txt* Podemos ver que en efecto esta es la flag del usuario con bajos privilegios. Lo más común sería utilizar find / -name user.txt (y en este caso, redirigir todo el stderr o Standard Error hacia el /dev/null), sin embargo, no conseguimos ningún resultado en esta máquina, por lo que resulta conveniente conocer otros métodos para realizar el mismo proceso. Escalada De Privilegios Para poder conseguir la siguiente flag (la del usuario con máximos privilegios), tenemos que percatarnos que la máquina tiene más puertos abiertos que los registrados con Nmap, a estos se los conoce como puertos internos. netstat -nlpt Si nos percatamos, la máquina utiliza el puerto 5555 para realizar varios procesos relacionados con Android; esto tiene sentido ya que algunos dispositivos Android tienen este puerto abierto para realizar procesos relacionados con el Android Debug Bridge o ADB por sus siglas en inglés. Por lo que, lo que vamos a realizar es un local port forwarding, para posteriormente, con el servicio ADB conseguir una shell de máximos privilegios con la que poder migrar al usuario root y conseguir la última flag. En caso de no contar con el servicio ADB instalado, bastará con realizar lo siguiente: sudo apt install adb Una vez instalado el servicio ADB, podemos pasar a conseguir una shell con máximos privilegios dentro del dispositivo. ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222 adb start-server adb connect localhost:5555 adb devices adb -s localhost:5555 shell su root Una vez hemos migrado al usuario root, simplemente tendremos que buscar la respectiva flag. echo **/*root.txt*" />
<meta property="og:site_name" content="Filthy Hacker" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-10-04T00:00:00-04:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Explore - Hack The Box" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Mateo Andino","url":"https://mateonitro550.github.io"},"dateModified":"2021-10-04T00:00:00-04:00","datePublished":"2021-10-04T00:00:00-04:00","description":"En esta ocasión vamos a estar resolviendo la máquina Explore de Hack The Box. Es una máquina Android de nivel de dificultad fácil en la intrusión, y medio en la escalada de privilegios según figura en la plataforma. Fase De Reconocimiento Primeramente vamos a lanzar una traza ICMP para saber si la máquina está activa. ping -c 1 10.10.10.247 Una vez comprobamos que la máquina está activa (pues nos devuelve una respuesta), podemos también determinar a que tipo de máquina nos estamos enfrentando en base al valor del TTL; en este caso el valor del TTL de la máquina es 63, por lo que podemos intuir que estamos ante una máquina Linux. Recordemos que algunos de los valores referenciales son los siguientes: Sistema Operativo (OS) TTL Linux 64 Windows 128 Solaris 254 Si nos damos cuenta, en esta ocasión, el valor del TTL es 63 y no 64 como indica la tabla anterior, esto se debe a que en el entorno de máquinas de Hack The Box, no nos comunicamos directamente con la máquina a vulnerar, sino que existe un nodo intermediario, por lo que el TTL disminuye en una unidad. ping -c 1 10.10.10.247 -R Posteriormente, vamos a utilizar la herramienta Nmap para determinar que puertos están abiertos, así como identificar la versión y servicios que corren en el activo. Para determinar que puertos están abiertos podemos realizar lo siguiente: nmap -p- --open -T5 -v -n 10.10.10.247 En caso de que el escaneo tarde demasiado en completar, tenemos esta otra alternativa: sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de puertos con Nmap: Parámetro Explicación -p- Escanea todo el rango de puertos (65535 en total) --open Nos indica todos aquellos puertos que están abiertos (o posiblemente abiertos) -T5 La plantilla de temporizado nos permite agilizar nuestro escaneo, este valor puede ir desde 0 hasta 5, cabe aclarar que a mayor sea el valor de la plantilla, “generaremos más ruido”, pero no pasa nada ¿no? Al fin y al cabo estamos practicando en un entorno controlado y aquí somos todos White Hat -v Verbose, reporta lo encontrado por consola -n No aplicar resolución DNS -sS Escaneo TCP SYN -min-rate Emitir paquetes no más lentos que &lt;valor&gt; por segundo -vvv Triple verbose, para obtener mayor información por consola -Pn No aplicar host discovery Una vez hemos detectado los puertos que se encuentran abiertos en el activo, podemos pasar a determinar la versión y servicios que corren bajo estos puertos. nmap -sC -sV -p 2222,42135,42607,59777 10.10.10.247 A continuación se explican los parámetros utilizados en el escaneo de versiones y servicios con Nmap: Parámetro Explicación -sC Scripts básicos de enumeración -sV Versión y servicios que corren bajo los puertos encontrados -p Especificamos que puertos queremos analizar (los que encontramos abiertos en el paso anterior) Basándonos en la información que nos reporta Nmap, podemos darnos cuenta que nos encontramos frente a un teléfono móvil, y nuestra primera gran pista para la siguiente fase es el puerto 42135. Fase De Explotación Para explotar el servicio ES File Explorer, empezaremos buscando algún exploit que se encuentre en Exploit Database, para ello utilizaremos SearchSploit para poder seguir trabajando desde nuestra terminal. searchsploit ES File Explorer En este caso SearchSploit no mostró nada interesante, sin embargo, si revisamos manualmente en la página de Exploit Database, podemos encontrar un script que nos permite leer archivos alojados en el servicio de ES File Explorer de versión 4.1.9.7.4, por esta razón es importante no quedarnos conformes únicamente con el primer resultado que encontremos. Sin embargo, tampoco será este el script con el que trabajaremos; en esta ocasión estaremos utilizando un proyecto de GitHub del usuario fs0c131y, este se llama ESFileExplorerOpenPortVuln. Para empezar a trabajar con este repositorio bastará con clonarlo en nuestra máquina. git clone https://github.com/fs0c131y/ESFileExplorerOpenPortVuln Una vez lo tengamos descargado, podemos empezar a revisar que información se alojaba en el servicio ES File Explorer. Después de estar listando el contenido almacenado en el teléfono móvil, encontramos entre las fotografías, una llamada creds, lo cual nos hace pensar a que se refiere a credenciales con las que posteriormente autenticarnos. python3 poc.py --cmd listPics --ip 10.10.10.247 Por lo que procedemos a descargar esta imagen. python3 poc.py --get-file /storage/emulated/0/DCIM/creds.jpg --ip 10.10.10.247 Si recordamos, otro servicio que detectamos con Nmap, fue el servicio SSH en el puerto 2222. Por lo que procederemos a autenticarnos con las credenciales encontradas: ssh kristi@10.10.10.247 -p 2222 Una vez dentro de la máquina, procederemos a buscar la primera flag. Por lo que buscaremos el archivo user.txt dentro de todo el sistema. echo **/*user.txt* Podemos ver que en efecto esta es la flag del usuario con bajos privilegios. Lo más común sería utilizar find / -name user.txt (y en este caso, redirigir todo el stderr o Standard Error hacia el /dev/null), sin embargo, no conseguimos ningún resultado en esta máquina, por lo que resulta conveniente conocer otros métodos para realizar el mismo proceso. Escalada De Privilegios Para poder conseguir la siguiente flag (la del usuario con máximos privilegios), tenemos que percatarnos que la máquina tiene más puertos abiertos que los registrados con Nmap, a estos se los conoce como puertos internos. netstat -nlpt Si nos percatamos, la máquina utiliza el puerto 5555 para realizar varios procesos relacionados con Android; esto tiene sentido ya que algunos dispositivos Android tienen este puerto abierto para realizar procesos relacionados con el Android Debug Bridge o ADB por sus siglas en inglés. Por lo que, lo que vamos a realizar es un local port forwarding, para posteriormente, con el servicio ADB conseguir una shell de máximos privilegios con la que poder migrar al usuario root y conseguir la última flag. En caso de no contar con el servicio ADB instalado, bastará con realizar lo siguiente: sudo apt install adb Una vez instalado el servicio ADB, podemos pasar a conseguir una shell con máximos privilegios dentro del dispositivo. ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222 adb start-server adb connect localhost:5555 adb devices adb -s localhost:5555 shell su root Una vez hemos migrado al usuario root, simplemente tendremos que buscar la respectiva flag. echo **/*root.txt*","headline":"Explore - Hack The Box","mainEntityOfPage":{"@type":"WebPage","@id":"/es/Explore-Hack-The-Box/"},"url":"/es/Explore-Hack-The-Box/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-PPKV9V8T');</script>
  <!-- End Google Tag Manager -->

</head>



<body>

  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PPKV9V8T"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->

  <div id="wrapper">
    <header>
  <div>
    <a href="/">
    
    <h1 class="glitch-header">filthyHacker@home:~$</h1>
    </a>
    <div class="header-links">
      <a href="/es"><h2 class="header-link">Publicaciones</h2></a>
<a href="/es/search"><h2 class="header-link">Buscar</h2></a>
<a href="/es/archive"><h2 class="header-link">Archivo</h2></a>
<a href="/en"><h2 class="header-link">English</h2></a>

    </div>
  </div>
</header>

    <div class="container">
      <section id="main_content">
        <article>
  <h2>Explore - Hack The Box</h2>
  <time datetime="2021-10-04T00:00:00-04:00" class="by-line">
    
      04/10/2021
    
  </time>
  <p>En esta ocasión vamos a estar resolviendo la máquina <em>Explore</em> de <em>Hack The Box</em>. Es una máquina <em>Android</em> de nivel de dificultad fácil en la intrusión, y medio en la escalada de privilegios según figura en la plataforma.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/1.png" alt="User Rated Difficulty" class="blog-image" onclick="expandImage(this)" /></p>

<h3 id="fase-de-reconocimiento"><a href="#header-3"></a>Fase De Reconocimiento</h3>

<p>Primeramente vamos a lanzar una <em>traza ICMP</em> para saber si la máquina está activa.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.10.247
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/2.png" alt="2" class="blog-image" onclick="expandImage(this)" /></p>

<p>Una vez comprobamos que la máquina está activa (pues nos devuelve una respuesta), podemos también determinar a que tipo de máquina nos estamos enfrentando en base al valor del <em>TTL</em>; en este caso el valor del <em>TTL</em> de la máquina es <code class="language-plaintext highlighter-rouge">63</code>, por lo que podemos intuir que estamos ante una máquina <em>Linux</em>. Recordemos que algunos de los valores referenciales son los siguientes:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Sistema Operativo (OS)</th>
      <th style="text-align: left">TTL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Linux</td>
      <td style="text-align: left">64</td>
    </tr>
    <tr>
      <td style="text-align: left">Windows</td>
      <td style="text-align: left">128</td>
    </tr>
    <tr>
      <td style="text-align: left">Solaris</td>
      <td style="text-align: left">254</td>
    </tr>
  </tbody>
</table>

<p>Si nos damos cuenta, en esta ocasión, el valor del <em>TTL</em> es <code class="language-plaintext highlighter-rouge">63</code> y no <code class="language-plaintext highlighter-rouge">64</code> como indica la tabla anterior, esto se debe a que en el entorno de máquinas de <em>Hack The Box</em>, no nos comunicamos directamente con la máquina a vulnerar, sino que existe un nodo intermediario, por lo que el <em>TTL</em> disminuye en una unidad.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ping -c 1 10.10.10.247 -R
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/3.png" alt="3" class="blog-image" onclick="expandImage(this)" /></p>

<p>Posteriormente, vamos a utilizar la herramienta <em>Nmap</em> para determinar que puertos están abiertos, así como identificar la versión y servicios que corren en el activo. Para determinar que puertos están abiertos podemos realizar lo siguiente:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-T5</span> <span class="nt">-v</span> <span class="nt">-n</span> 10.10.10.247
</code></pre></div></div>

<p>En caso de que el escaneo tarde demasiado en completar, tenemos esta otra alternativa:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>nmap <span class="nt">-p-</span> <span class="nt">--open</span> <span class="nt">-sS</span> <span class="nt">--min-rate</span> 5000 <span class="nt">-vvv</span> <span class="nt">-n</span> <span class="nt">-Pn</span> 10.10.10.247
</code></pre></div></div>

<p>A continuación se explican los parámetros utilizados en el escaneo de puertos con <em>Nmap</em>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parámetro</th>
      <th style="text-align: left">Explicación</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">-p-</td>
      <td style="text-align: left">Escanea todo el rango de puertos (65535 en total)</td>
    </tr>
    <tr>
      <td style="text-align: left">--open</td>
      <td style="text-align: left">Nos indica todos aquellos puertos que están abiertos (o posiblemente abiertos)</td>
    </tr>
    <tr>
      <td style="text-align: left">-T5</td>
      <td style="text-align: left">La plantilla de temporizado nos permite agilizar nuestro escaneo, este valor puede ir desde 0 hasta 5, cabe aclarar que a mayor sea el valor de la plantilla, “generaremos más ruido”, pero no pasa nada ¿no? Al fin y al cabo estamos practicando en un entorno controlado y aquí somos todos <code class="language-plaintext highlighter-rouge">White Hat</code></td>
    </tr>
    <tr>
      <td style="text-align: left">-v</td>
      <td style="text-align: left"><em>Verbose</em>, reporta lo encontrado por consola</td>
    </tr>
    <tr>
      <td style="text-align: left">-n</td>
      <td style="text-align: left">No aplicar <em>resolución DNS</em></td>
    </tr>
    <tr>
      <td style="text-align: left">-sS</td>
      <td style="text-align: left">Escaneo <em>TCP SYN</em></td>
    </tr>
    <tr>
      <td style="text-align: left">-min-rate</td>
      <td style="text-align: left">Emitir paquetes no más lentos que &lt;valor&gt; por segundo</td>
    </tr>
    <tr>
      <td style="text-align: left">-vvv</td>
      <td style="text-align: left">Triple <em>verbose</em>, para obtener mayor información por consola</td>
    </tr>
    <tr>
      <td style="text-align: left">-Pn</td>
      <td style="text-align: left">No aplicar <em>host discovery</em></td>
    </tr>
  </tbody>
</table>

<p>Una vez hemos detectado los puertos que se encuentran abiertos en el activo, podemos pasar a determinar la versión y servicios que corren bajo estos puertos.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap <span class="nt">-sC</span> <span class="nt">-sV</span> <span class="nt">-p</span> 2222,42135,42607,59777 10.10.10.247
</code></pre></div></div>

<p>A continuación se explican los parámetros utilizados en el escaneo de versiones y servicios con <em>Nmap</em>:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Parámetro</th>
      <th style="text-align: left">Explicación</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">-sC</td>
      <td style="text-align: left">Scripts básicos de enumeración</td>
    </tr>
    <tr>
      <td style="text-align: left">-sV</td>
      <td style="text-align: left">Versión y servicios que corren bajo los puertos encontrados</td>
    </tr>
    <tr>
      <td style="text-align: left">-p</td>
      <td style="text-align: left">Especificamos que puertos queremos analizar (los que encontramos abiertos en el paso anterior)</td>
    </tr>
  </tbody>
</table>

<p>Basándonos en la información que nos reporta <em>Nmap</em>, podemos darnos cuenta que nos encontramos frente a un teléfono móvil, y nuestra primera gran pista para la siguiente fase es el puerto <code class="language-plaintext highlighter-rouge">42135</code>.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/4.png" alt="4" class="blog-image" onclick="expandImage(this)" /></p>

<h3 id="fase-de-explotación"><a href="#header-3"></a>Fase De Explotación</h3>

<p>Para explotar el servicio <code class="language-plaintext highlighter-rouge">ES File Explorer</code>, empezaremos buscando algún exploit que se encuentre en <em>Exploit Database</em>, para ello utilizaremos <em>SearchSploit</em> para poder seguir trabajando desde nuestra terminal.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>searchsploit ES File Explorer
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/5.png" alt="5" class="blog-image" onclick="expandImage(this)" /></p>

<p>En este caso <em>SearchSploit</em> no mostró nada interesante, sin embargo, si revisamos manualmente en la página de <em>Exploit Database</em>, podemos encontrar un script que nos permite leer archivos alojados en el servicio de <code class="language-plaintext highlighter-rouge">ES File Explorer</code> de versión <code class="language-plaintext highlighter-rouge">4.1.9.7.4</code>, por esta razón es importante no quedarnos conformes únicamente con el primer resultado que encontremos.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/6.png" alt="6" class="blog-image" onclick="expandImage(this)" /></p>

<p>Sin embargo, tampoco será este el script con el que trabajaremos; en esta ocasión estaremos utilizando un proyecto de <em>GitHub</em> del usuario <em>fs0c131y</em>, este se llama <a href="https://github.com/fs0c131y/ESFileExplorerOpenPortVuln">ESFileExplorerOpenPortVuln</a>.</p>

<p>Para empezar a trabajar con este repositorio bastará con clonarlo en nuestra máquina.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://github.com/fs0c131y/ESFileExplorerOpenPortVuln
</code></pre></div></div>

<p>Una vez lo tengamos descargado, podemos empezar a revisar que información se alojaba en el servicio <code class="language-plaintext highlighter-rouge">ES File Explorer</code>.</p>

<p>Después de estar listando el contenido almacenado en el teléfono móvil, encontramos entre las fotografías, una llamada <code class="language-plaintext highlighter-rouge">creds</code>, lo cual nos hace pensar a que se refiere a credenciales con las que posteriormente autenticarnos.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 poc.py --cmd listPics --ip 10.10.10.247
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/7.png" alt="7" class="blog-image" onclick="expandImage(this)" /></p>

<p>Por lo que procedemos a descargar esta imagen.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>python3 poc.py --get-file /storage/emulated/0/DCIM/creds.jpg --ip 10.10.10.247 
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/8.png" alt="8" class="blog-image" onclick="expandImage(this)" /></p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/9.png" alt="9" class="blog-image" onclick="expandImage(this)" /></p>

<p>Si recordamos, otro servicio que detectamos con <em>Nmap</em>, fue el servicio <em>SSH</em> en el puerto <code class="language-plaintext highlighter-rouge">2222</code>.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/10.png" alt="10" class="blog-image" onclick="expandImage(this)" /></p>

<p>Por lo que procederemos a autenticarnos con las credenciales encontradas:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh kristi@10.10.10.247 -p 2222
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/11.png" alt="11" class="blog-image" onclick="expandImage(this)" /></p>

<p>Una vez dentro de la máquina, procederemos a buscar la primera flag. Por lo que buscaremos el archivo <code class="language-plaintext highlighter-rouge">user.txt</code> dentro de todo el sistema.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo **/*user.txt*
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/12.png" alt="12" class="blog-image" onclick="expandImage(this)" /></p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/13.png" alt="13" class="blog-image" onclick="expandImage(this)" /></p>

<p>Podemos ver que en efecto esta es la flag del usuario con bajos privilegios.</p>

<p>Lo más común sería utilizar <code class="language-plaintext highlighter-rouge">find / -name user.txt</code> (y en este caso, redirigir todo el <em>stderr</em> o <em>Standard Error</em> hacia el <code class="language-plaintext highlighter-rouge">/dev/null</code>), sin embargo, no conseguimos ningún resultado en esta máquina, por lo que resulta conveniente conocer otros métodos para realizar el mismo proceso.</p>

<h3 id="escalada-de-privilegios"><a href="#header-3"></a>Escalada De Privilegios</h3>

<p>Para poder conseguir la siguiente flag (la del usuario con máximos privilegios), tenemos que percatarnos que la máquina tiene más puertos abiertos que los registrados con <em>Nmap</em>, a estos se los conoce como <em>puertos internos</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>netstat -nlpt
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/14.png" alt="14" class="blog-image" onclick="expandImage(this)" /></p>

<p>Si nos percatamos, la máquina utiliza el puerto <code class="language-plaintext highlighter-rouge">5555</code> para realizar varios procesos relacionados con <em>Android</em>; esto tiene sentido ya que algunos dispositivos <em>Android</em> tienen este puerto abierto para realizar procesos relacionados con el <code class="language-plaintext highlighter-rouge">Android Debug Bridge</code> o <code class="language-plaintext highlighter-rouge">ADB</code> por sus siglas en inglés.</p>

<p>Por lo que, lo que vamos a realizar es un <code class="language-plaintext highlighter-rouge">local port forwarding</code>, para posteriormente, con el servicio <code class="language-plaintext highlighter-rouge">ADB</code> conseguir una shell de máximos privilegios con la que poder migrar al usuario root y conseguir la última flag.</p>

<p>En caso de no contar con el servicio <code class="language-plaintext highlighter-rouge">ADB</code> instalado, bastará con realizar lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo apt install adb
</code></pre></div></div>

<p>Una vez instalado el servicio <code class="language-plaintext highlighter-rouge">ADB</code>, podemos pasar a conseguir una shell con máximos privilegios dentro del dispositivo.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ssh -L 5555:localhost:5555 kristi@10.10.10.247 -p 2222
</code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>adb start-server
adb connect localhost:5555
adb devices
adb -s localhost:5555 shell
su root
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/15.png" alt="15" class="blog-image" onclick="expandImage(this)" /></p>

<p>Una vez hemos migrado al usuario root, simplemente tendremos que buscar la respectiva flag.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>echo **/*root.txt*
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/main/assets/2021-10-04-Explore-Hack-The-Box/16.png" alt="16" class="blog-image" onclick="expandImage(this)" /></p>

</article>

<div id="carousel" class="carousel">
  <img id="carouselImage" class="carousel-image">
  <div id="carouselAlt" class="carousel-alt"></div>
  <button class="carousel-control prev" onclick="prevImage()">&#10094;</button>
  <button class="carousel-control next" onclick="nextImage()">&#10095;</button>
</div>

<div class="image-overlay" onclick="closeImage()"></div>
<img id="expandedImage" class="expanded-image">

<script>
  document.addEventListener('DOMContentLoaded', function() {
    var tocList = document.getElementById('toc-list');
    var headers = document.querySelectorAll('article h3');

    if (headers.length > 0) {
      document.querySelector('.toc').style.display = 'block';

      headers.forEach(function(header, index) {
        var id = 'section-' + index;
        header.id = id;

        var listItem = document.createElement('li');
        var link = document.createElement('a');
        link.href = '#' + id;
        link.textContent = header.textContent;
        listItem.appendChild(link);
        tocList.appendChild(listItem);
      });
    } else {
      document.querySelector('.toc').style.display = 'none';
    }
  });

  var currentImageIndex = 0;
  var images = [];
  var altTexts = [];

  document.querySelectorAll('.blog-image').forEach((img, index) => {
    images.push(img.src);
    altTexts.push(img.alt || '');
    img.setAttribute('data-index', index);
    img.onclick = () => expandImage(img);
  });

  function expandImage(img) {
    currentImageIndex = parseInt(img.getAttribute('data-index'));
    showImage(currentImageIndex);
    document.getElementById('carousel').style.display = 'block';
    document.querySelector('.image-overlay').style.display = 'block';
    document.body.style.overflow = 'hidden';

    document.addEventListener('keydown', handleKeyPress);

    document.querySelectorAll('.carousel-control').forEach(control => {
      control.style.display = 'block';
    });
  }

  function showImage(index) {
    var carouselImg = document.getElementById('carouselImage');
    carouselImg.src = images[index];
    
    var carouselAlt = document.getElementById('carouselAlt');
    carouselAlt.textContent = altTexts[index];
  }

  function closeImage() {
    document.getElementById('carousel').style.display = 'none';
    document.querySelector('.image-overlay').style.display = 'none';
    document.body.style.overflow = 'auto';

    document.removeEventListener('keydown', handleKeyPress);

    document.querySelectorAll('.carousel-control').forEach(control => {
      control.style.display = 'none';
    });
  }

  function prevImage() {
    currentImageIndex = (currentImageIndex - 1 + images.length) % images.length;
    showImage(currentImageIndex);
  }

  function nextImage() {
    currentImageIndex = (currentImageIndex + 1) % images.length;
    showImage(currentImageIndex);
  }

  function handleKeyPress(event) {
    if (event.key === 'Escape') {
      closeImage();
    } else if (event.key === 'ArrowLeft') {
      prevImage();
    } else if (event.key === 'ArrowRight') {
      nextImage();
    }
  }
</script>

      </section>
    </div>
  </div>

  

  <footer>
  <a href="https://creativecommons.org/licenses/by-nc/4.0/">
    <span>
        <b>MateoNitro550</b>
    </span>
    
    <span>© 2024</span>
  </a>
</footer>


  
    <script type="text/javascript">
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'G-524F5BE8G5', 'auto');
  ga('send', 'pageview');
</script>
  

</body>
</html>
